upstream im_msg_gateway{
            server 127.0.0.1:10001;        #指定后端服务器地址 根据部署情况可指定多台
        }
upstream im_api{
            server 127.0.0.1:10002;        #指定后端服务器地址 根据部署情况可指定多台
        }
upstream im_jssdk_gateway{
            server 127.0.0.1:10003;        #指定后端服务器地址 根据部署情况可指定多台
        }
upstream im_demo{
            server 127.0.0.1:10004;        #指定后端服务器地址 根据部署情况可指定多台
        }
upstream im_admin{
            server 127.0.0.1:10006;        #指定后端服务器地址 根据部署情况可指定多台
        }
upstream im_grafana{
            server 127.0.0.1:10007;        #指定后端服务器地址 docker-compose启动所在机器
        }
upstream im_chat{
            server 127.0.0.1:10008;        #指定后端服务器地址 根据部署情况可指定多台
        }
upstream im_complete_admin{
            server 127.0.0.1:10009;         #指定后端服务器地址 根据部署情况可指定多台
        }
upstream im_organization{
            server 127.0.0.1:10010;        #指定后端服务器地址 根据部署情况可指定多台
        }

server {
        listen 443;
        server_name open-im-online.rentsoft.cn;   #1
        ssl on;
        ssl_certificate /etc/nginx/conf.d/ssl/open-im-online.rentsoft.cn.crt; #2
        ssl_certificate_key /etc/nginx/conf.d/ssl/open-im-online.rentsoft.cn.key; #3
        ssl_session_timeout 5m;
		gzip on;
		gzip_min_length 1k;
		gzip_buffers 4 16k;
		gzip_comp_level 2;
		gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
		gzip_vary off;
		gzip_disable "MSIE [1-6]\.";
        error_page 405 =200 $uri;
        location / { #web demo
                proxy_set_header Host $host;
                proxy_set_header X-Real-Ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_set_header X-NginX-Proxy true;
                root /data1/online/Pc-Web-Demo/build/; #4
                index index.html;
                try_files $uri $uri/ /index.html;
        }

        location /msg_gateway { #10001 ws
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://im_msg_gateway;
        }

        location /api { #10002 api
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://im_api;
               }

        location /jssdk_gateway { #10003 jssdk
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://im_jssdk_gateway;
               }

        location /demo { # 10004 demo
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://im_demo;
               }

        location /admin { #10006 admin
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://im_admin;
               }
        location /grafana { #10007  prometheus
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://im_grafana;
               }
        location /chat { #10008 chat login
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://im_chat;
               }
        location /complete_admin { #10009  admin
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://im_complete_admin;
               }
        location /organization { #10010 organization
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://im_organization;
               }//organization
}


server {
        listen 80;
        server_name open-im-online.rentsoft.cn; #1
        rewrite ^(.*)$ https://${server_name}$1 permanent;
}








server {
        listen 51000;
        server_name open-im-online.rentsoft.cn;
        ssl on;
        ssl_certificate /etc/nginx/conf.d/ssl/open-im-online.rentsoft.cn.crt;
        ssl_certificate_key /etc/nginx/conf.d/ssl/open-im-online.rentsoft.cn.key;
        ssl_session_timeout 5m;

        client_max_body_size 200m;
        gzip on;
        gzip_min_length 1k;
        gzip_buffers 4 16k;
        gzip_comp_level 2;
        gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
        gzip_vary off;
        gzip_disable "MSIE [1-6]\.";
        location / {
                            proxy_http_version 1.1;
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://127.0.0.1:8081;
        }
}


server {
        listen 57880;
        server_name open-im-online.rentsoft.cn;
        ssl on;
        ssl_certificate /etc/nginx/conf.d/ssl/open-im-online.rentsoft.cn.crt;
        ssl_certificate_key /etc/nginx/conf.d/ssl/open-im-online.rentsoft.cn.key;
        ssl_session_timeout 5m;

        gzip on;
        gzip_min_length 1k;
        gzip_buffers 4 16k;
        gzip_comp_level 2;
        gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
        gzip_vary off;
        gzip_disable "MSIE [1-6]\.";
        location / {
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://127.0.0.1:7880;
        }
}




upstream storage {
    server 127.0.0.1:10005;
}

server {
  #      listen 443;
   #     server_name storage-online.rentsoft.cn;
    #    ssl on
     #   ssl_certificate /etc/nginx/conf.d/ssl/storage-online.rentsoft.cn_bundle.crt;
      #  ssl_certificate_key /etc/nginx/conf.d/ssl/storage-online.rentsoft.cn.key; 
        ssl_session_timeout 5m;

 listen 443;
        server_name storage-online.rentsoft.cn;

        ssl on;
        ssl_certificate /etc/nginx/conf.d/ssl/storage-online.rentsoft.cn_nginx/storage-online.rentsoft.cn_bundle.crt;
        ssl_certificate_key /etc/nginx/conf.d/ssl/storage-online.rentsoft.cn_nginx/storage-online.rentsoft.cn.key;


        gzip on;
        gzip_min_length 1k;
        gzip_buffers 4 16k;
        gzip_comp_level 2;
        gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
        gzip_vary off;
        gzip_disable "MSIE [1-6]\.";

    location / {
            proxy_pass http://127.0.0.1:10005/;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header Host $http_host;
            proxy_http_version 1.1;
            client_max_body_size 8000M;

    }
}
